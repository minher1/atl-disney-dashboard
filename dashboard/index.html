<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disney Enterprise Entitlements Dashboard</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/dashboard.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-dark bg-primary">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1 d-flex align-items-center">
                <img src="https://upload.wikimedia.org/wikipedia/commons/3/3e/Disney%2B_logo.svg"
                     alt="Disney Logo"
                     height="32"
                     class="me-2"
                     onerror="this.style.display='none'">
                <span>Enterprise Entitlements Dashboard</span>
            </span>
            <div class="d-flex align-items-center text-white">
                <span id="recordCount" class="me-3">Loading...</span>
                <button class="btn btn-light btn-sm" onclick="exportToCSV()">
                    <i class="bi bi-download"></i> Export Data
                </button>
            </div>
        </div>
    </nav>

    <!-- Loading Indicator -->
    <div id="loadingIndicator" class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3">Loading entitlements data...</p>
    </div>

    <!-- Main Dashboard Content -->
    <div id="dashboardContent" class="container-fluid py-4" style="display: none;">
        
        <!-- Filters Section -->
        <div class="card mb-4">
            <div class="card-header bg-light">
                <h5 class="mb-0"><i class="bi bi-funnel"></i> Filters</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label for="brandFilter" class="form-label">Brand</label>
                        <select id="brandFilter" class="form-select" onchange="applyFilters()">
                            <option value="">All Brands</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="regionFilter" class="form-label">Region</label>
                        <select id="regionFilter" class="form-select" onchange="applyFilters()">
                            <option value="">All Regions</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="customerFilter" class="form-label">Customer</label>
                        <input type="text" id="customerFilter" class="form-control" 
                               placeholder="Search customer..." onkeyup="applyFilters()">
                    </div>
                    <div class="col-md-3">
                        <label for="productFilter" class="form-label">Product</label>
                        <input type="text" id="productFilter" class="form-control" 
                               placeholder="Search product..." onkeyup="applyFilters()">
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <button class="btn btn-secondary btn-sm" onclick="resetFilters()">
                            <i class="bi bi-arrow-counterclockwise"></i> Reset Filters
                        </button>
                        <span id="filterStatus" class="ms-3 text-muted"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- KPI Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-white bg-primary">
                    <div class="card-body">
                        <h6 class="card-title">Total Records</h6>
                        <h2 id="kpiTotalRecords">0</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-white bg-success">
                    <div class="card-body">
                        <h6 class="card-title">Total Quantity</h6>
                        <h2 id="kpiTotalQuantity">0</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-white bg-info">
                    <div class="card-body">
                        <h6 class="card-title">Unique Brands</h6>
                        <h2 id="kpiUniqueBrands">0</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-white bg-warning">
                    <div class="card-body">
                        <h6 class="card-title">Unique Customers</h6>
                        <h2 id="kpiUniqueCustomers">0</h2>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Row 1 -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Brand Distribution by Quantity</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="brandChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Top 10 Products by Quantity</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="productChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Row 2 -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Regional Distribution</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="regionChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Support Level Distribution</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="supportChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Business Opportunities -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-warning">
                        <h5 class="mb-0"><i class="bi bi-lightbulb"></i> Business Opportunities</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="alert alert-info">
                                    <h6>Licenses Without S&S</h6>
                                    <h3 id="oppNoSS">0</h3>
                                    <small>Potential upsell opportunities</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="alert alert-warning">
                                    <h6>S&S Expiring Soon (90 days)</h6>
                                    <h3 id="oppExpiring">0</h3>
                                    <small>Renewal opportunities</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="alert alert-success">
                                    <h6>High Deployment Ratio</h6>
                                    <h3 id="oppExpansion">0</h3>
                                    <small>Expansion opportunities</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Products by Brand & Customer -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0"><i class="bi bi-list-check"></i> Active Products by Brand & Customer</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <input type="text" id="brandCustomerSearch" class="form-control" 
                                   placeholder="Search by brand or customer..." onkeyup="filterBrandCustomerTable()">
                        </div>
                        <div class="table-responsive" style="max-height: 600px;">
                            <table class="table table-striped table-hover table-sm" id="brandCustomerTable">
                                <thead class="sticky-top bg-light">
                                    <tr>
                                        <th onclick="sortBrandCustomerTable('brand')">Brand <i class="bi bi-arrow-down-up"></i></th>
                                        <th onclick="sortBrandCustomerTable('customer')">Customer <i class="bi bi-arrow-down-up"></i></th>
                                        <th onclick="sortBrandCustomerTable('product')">Current Product <i class="bi bi-arrow-down-up"></i></th>
                                        <th onclick="sortBrandCustomerTable('quantity')" class="text-end">Active S&S Quantity <i class="bi bi-arrow-down-up"></i></th>
                                        <th onclick="sortBrandCustomerTable('endDate')">S&S End Date <i class="bi bi-arrow-down-up"></i></th>
                                    </tr>
                                </thead>
                                <tbody id="brandCustomerTableBody">
                                    <!-- Data will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-3">
                            <span id="brandCustomerStatus" class="text-muted"></span>
                            <button class="btn btn-success btn-sm float-end" onclick="exportBrandCustomerData()">
                                <i class="bi bi-download"></i> Export This View
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Data Table -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Detailed Data View</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover" id="dataTable">
                                <thead>
                                    <tr>
                                        <th onclick="sortTable('Brand')">Brand <i class="bi bi-arrow-down-up"></i></th>
                                        <th onclick="sortTable('Customer name')">Customer <i class="bi bi-arrow-down-up"></i></th>
                                        <th onclick="sortTable('Current product')">Product <i class="bi bi-arrow-down-up"></i></th>
                                        <th onclick="sortTable('Software license or appliance quantity')">Quantity <i class="bi bi-arrow-down-up"></i></th>
                                        <th onclick="sortTable('CRM region')">Region <i class="bi bi-arrow-down-up"></i></th>
                                        <th onclick="sortTable('Active S&S end date')">S&S End Date <i class="bi bi-arrow-down-up"></i></th>
                                    </tr>
                                </thead>
                                <tbody id="tableBody">
                                    <!-- Data will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-3">
                            <button class="btn btn-primary btn-sm" onclick="loadMoreRows()">
                                Load More Rows
                            </button>
                            <span id="tableStatus" class="ms-3 text-muted"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script src="js/data-loader.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/filters.js"></script>
    <script src="js/utils.js"></script>
</body>
</html>